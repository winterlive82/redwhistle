<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="내부자신고 사전상담 시스템 - AI 상담 및 레드휘슬 익명 신고 연동">
  <title>내부자신고 사전상담 시스템</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <!-- Header -->
  <header class="app-header">
    <div class="header-inner">
      <a href="#" class="logo" onclick="goHome(event)">
        <div class="logo-icon">🛡️</div>
        <span class="logo-text">내부자신고 상담</span>
      </a>
      <span class="header-badge">PoC v2.0 · AI 상담 · 익명 보장</span>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero" id="hero">
    <div class="app-container hero-content">
      <div class="hero-icon">🔐</div>
      <h1>내부자신고 사전상담 시스템</h1>
      <p class="hero-subtitle">
        AI 상담으로 신고 해당 여부를 확인하고,<br>
        신고서 초안까지 자동으로 작성해 드립니다.
      </p>
      <div class="anonymity-banner">
        <span class="icon">🔒</span>
        <span>이 시스템은 서버에 어떠한 대화 로그도 저장하지 않습니다. 모든 대화 내용은 브라우저 메모리에만 존재하며, 페이지를 닫으면 즉시 폐기됩니다.</span>
      </div>
      <div class="anonymity-banner"
        style="margin-top: 12px; background: rgba(245, 158, 11, 0.08); border-color: rgba(245, 158, 11, 0.25);">
        <span class="icon">📱</span>
        <span style="color: var(--accent-amber-light);">
          <strong>익명성 극대화를 위해 개인 기기(스마트폰, 개인 PC 등)에서 접속하시기를 권장합니다.</strong><br>
          회사 네트워크(Wi-Fi, 유선망)가 아닌 개인 모바일 데이터(LTE/5G) 사용 시 접속 기록이 회사에 남지 않습니다.
        </span>
      </div>
    </div>
  </section>

  <!-- Step Navigation -->
  <div class="app-container">
    <nav class="step-nav" id="stepNav">
      <div class="step-nav-item active" data-step="1" onclick="goToStep(1)">
        <span class="step-num">1</span>
        <span>AI 상담</span>
      </div>
      <div class="step-connector">→</div>
      <div class="step-nav-item" data-step="2" onclick="goToStep(2)">
        <span class="step-num">2</span>
        <span>신고서 생성</span>
      </div>
      <div class="step-connector">→</div>
      <div class="step-nav-item" data-step="3" onclick="goToStep(3)">
        <span class="step-num">3</span>
        <span>레드휘슬 신고</span>
      </div>
    </nav>

    <!-- ===================== STEP 1: AI 상담 채팅 ===================== -->
    <div class="step-panel active" id="step1">
      <h2 class="section-title">STEP 1. AI 사전상담</h2>
      <p class="section-desc">
        신고하려는 사안에 대해 AI와 상담하세요. 관련 법률과 내부규정을 기반으로<br>
        신고 대상 여부를 판단하고, 구체적으로 어떤 부분이 문제가 되는지 안내해 드립니다.
      </p>

      <div class="warning-box">
        <span class="icon">⚠️</span>
        <div>
          <strong>익명성 주의사항:</strong> 대화 중 본인이나 특정인을 식별할 수 있는
          정보(실명, 정확한 부서명, 구체적 일시 등)는 입력하지 마세요.
          AI도 식별 정보를 묻지 않습니다.
        </div>
      </div>

      <!-- Chat Container -->
      <div class="chat-container" id="chatContainer">
        <div class="chat-messages" id="chatMessages">
          <!-- Welcome message -->
          <div class="chat-message ai">
            <div class="chat-avatar">🤖</div>
            <div class="chat-bubble">
              안녕하세요. 내부자신고 사전상담 AI 어시스턴트입니다.<br><br>
              신고하고 싶은 사안이 있으시면 편하게 말씀해 주세요.
              관련 법률과 내부규정을 기반으로 신고 대상에 해당하는지 함께 확인해 보겠습니다.<br><br>
              💡 <em>예시: "거래처 직원이 우리 회사 담당자에게 고가 선물을 보내는 것을 봤어요"</em>
            </div>
          </div>
        </div>

        <!-- Typing indicator -->
        <div class="typing-indicator" id="typingIndicator" style="display: none;">
          <div class="chat-avatar">🤖</div>
          <div class="typing-dots">
            <span></span><span></span><span></span>
          </div>
        </div>

        <!-- Chat Input -->
        <div class="chat-input-area">
          <textarea class="chat-input" id="chatInput" placeholder="상담 내용을 입력하세요..." rows="1"
            onkeydown="handleChatKeydown(event)" oninput="autoResizeInput(this)"></textarea>
          <button class="chat-send-btn" id="sendBtn" onclick="sendMessage()">
            <span>전송</span>
          </button>
        </div>
      </div>

      <div style="display: flex; gap: 12px; margin-top: 20px;">
        <button class="btn btn-success" onclick="requestReport()" id="reportBtn" style="flex: 1;" disabled>
          📄 대화 내용 기반 신고서 초안 생성
        </button>
        <button class="btn btn-secondary" onclick="goToStep(2)">
          다음 단계 →
        </button>
      </div>
    </div>

    <!-- ===================== STEP 2: 신고서 생성 ===================== -->
    <div class="step-panel" id="step2">
      <h2 class="section-title">STEP 2. 신고서 초안 확인</h2>
      <p class="section-desc">
        AI 상담 내용을 바탕으로 생성된 신고서 초안입니다.<br>
        내용을 확인하고 수정한 후, 레드휘슬에 복사하여 제출하세요.
      </p>

      <div class="info-box">
        💡 이 페이지의 모든 내용은 <strong>브라우저 메모리에만</strong> 존재합니다.
        서버 전송, 쿠키 저장, 로컬스토리지 저장이 일체 없으며,
        페이지를 닫거나 "데이터 폐기" 버튼을 클릭하면 즉시 삭제됩니다.
      </div>

      <!-- Report Display -->
      <div class="card" id="reportCard">
        <div class="card-header">
          <div class="card-icon purple">📄</div>
          <div class="card-title">레드휘슬 신고서 초안</div>
        </div>
        <div class="card-body">
          <div class="report-content" id="reportContent">
            <p style="color: var(--text-muted); text-align: center; padding: 40px 0;">
              STEP 1에서 AI 상담을 진행한 후<br>"신고서 초안 생성" 버튼을 클릭하면<br>이곳에 신고서가 표시됩니다.
            </p>
          </div>
        </div>
      </div>

      <!-- Editable report area -->
      <div class="card" id="editCard" style="display: none;">
        <div class="card-header">
          <div class="card-icon green">✏️</div>
          <div class="card-title">신고서 수정 (선택사항)</div>
        </div>
        <div class="card-body">
          <textarea class="notes-area" id="reportEditArea" placeholder="위 초안을 수정하려면 여기에 내용을 편집하세요."
            style="min-height: 300px;"></textarea>
          <div class="notes-warning">
            <span>⚠️</span>
            <span>이 메모는 서버에 저장되지 않습니다. 페이지를 닫으면 영구 삭제됩니다.</span>
          </div>
        </div>
      </div>

      <div class="prompt-actions" style="margin-top: 20px;">
        <button class="btn btn-primary" id="copyReportBtn" onclick="copyReport()" style="display: none;">
          <span class="default">📋 신고서 복사</span>
          <span class="copied">✅ 복사됨!</span>
        </button>
        <button class="btn btn-secondary" onclick="goToStep(1)">← AI 상담으로</button>
        <button class="btn btn-success" onclick="goToStep(3)">
          레드휘슬 신고 안내 →
        </button>
      </div>
    </div>

    <!-- ===================== STEP 3: 레드휘슬 신고 ===================== -->
    <div class="step-panel" id="step3">
      <h2 class="section-title">STEP 3. 레드휘슬 익명 신고</h2>
      <p class="section-desc">
        실제 신고는 레드휘슬(RedWhistle)을 통해 진행됩니다.<br>
        레드휘슬은 독립된 제3자 운영 시스템으로, <strong>기술적 익명성이 완벽히 보장</strong>됩니다.
      </p>

      <!-- RedWhistle Card -->
      <div class="redwhistle-card">
        <div class="rw-logo">🚨</div>
        <h3>레드휘슬 헬프라인</h3>
        <p>
          레드휘슬은 외부 독립기관이 운영하는 익명 신고 플랫폼입니다.<br>
          STEP 2에서 복사한 신고서 초안을 붙여넣기하여 제출하세요.
        </p>
        <a href="https://www.redwhistle.org/main/" target="_blank" rel="noopener" class="redwhistle-link">
          🔗 레드휘슬 사이트로 이동
        </a>
      </div>

      <!-- Guide -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon purple">📖</div>
          <div class="card-title">레드휘슬 이용 절차</div>
        </div>
        <div class="card-body">
          <ol class="instructions">
            <li>
              <div class="instruction-text">레드휘슬 사이트에 접속하여 <strong>신고 유형을 선택</strong>합니다.</div>
            </li>
            <li>
              <div class="instruction-text">STEP 2에서 복사한 <strong>신고서 초안을 붙여넣기</strong>합니다.<span class="sub">필요 시 관련 파일을
                  첨부할 수 있습니다.</span></div>
            </li>
            <li>
              <div class="instruction-text"><strong>비밀번호를 설정</strong>한 후 신고서를 제출합니다.<span class="sub">⚠️ 비밀번호와 발급받은
                  고유번호를 반드시 메모하세요!</span></div>
            </li>
            <li>
              <div class="instruction-text">신고서 제출 <strong>약 7일 후</strong> 레드휘슬 시스템에서 처리 결과를 확인합니다.<span
                  class="sub">담당자가 추가 정보를 요청할 수 있으니 정기적으로 확인해 주세요.</span></div>
            </li>
          </ol>
        </div>
      </div>

      <!-- Whistleblower protection -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon red">🔒</div>
          <div class="card-title">신고자 보호 안내</div>
        </div>
        <div class="card-body">
          <ul style="list-style: none; display: flex; flex-direction: column; gap: 12px;">
            <li style="display: flex; align-items: flex-start; gap: 10px;"><span>✅</span><span>레드휘슬은 <strong>외부
                  독립기관</strong>이 운영하며, 회사가 신고자를 특정할 수 없습니다.</span></li>
            <li style="display: flex; align-items: flex-start; gap: 10px;">
              <span>✅</span><span><strong>공익신고자보호법</strong>에 의해 신고자는 법적으로 보호받습니다.</span></li>
            <li style="display: flex; align-items: flex-start; gap: 10px;"><span>✅</span><span>신고를 이유로 한 <strong>불이익
                  조치(해고, 징계, 차별 등)는 법률로 금지</strong>되어 있습니다.</span></li>
            <li style="display: flex; align-items: flex-start; gap: 10px;"><span>✅</span><span>이 사전상담 시스템의 AI 대화 로그는 서버에
                저장되지 않으며, <strong>아래 버튼으로 즉시 폐기</strong>할 수 있습니다.</span></li>
          </ul>
        </div>
      </div>

      <div style="display: flex; gap: 12px; margin-top: 24px;">
        <button class="btn btn-secondary" onclick="goToStep(2)">← 이전 단계</button>
      </div>

      <!-- Destroy Section -->
      <div class="destroy-section">
        <h3>🗑️ 세션 데이터 완전 폐기</h3>
        <p>
          신고가 완료되었거나 더 이상 이 페이지가 필요 없다면,<br>
          아래 버튼을 클릭하여 모든 대화 내용과 신고서를 즉시 삭제하세요.
        </p>
        <button class="btn btn-danger btn-lg" onclick="destroyAllData()">
          🔥 모든 데이터 즉시 폐기
        </button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="app-footer">
    <div class="app-container">
      <div class="security-badges">
        <span class="security-badge">🔒 대화 로그 미저장</span>
        <span class="security-badge">🚫 쿠키 미사용</span>
        <span class="security-badge">🛡️ 익명성 보장</span>
        <span class="security-badge">💨 세션 종료 시 자동 폐기</span>
      </div>
      <p>내부자신고 사전상담 시스템 PoC v2.0 · AI 상담 내용은 서버에 저장되지 않습니다.</p>
    </div>
  </footer>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script src="app.js"></script>
</body>

</html>